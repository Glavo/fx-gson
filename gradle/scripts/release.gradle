def execute = { String command ->
    exec {
        workingDir rootProject.projectDir
        commandLine command.split()
    }
}

task commitRelease {
    doLast {
        execute("git add build.gradle")
        execute("git add CHANGELOG.md")
        execute("git commit -m \"Version ${project.version}\"")
        execute("git push")
    }
}
commitRelease.dependsOn(generateChangelog)

task tagRelease {
    doLast {
        execute("git tag -a v${project.version} -m \"Version ${project.version}\"")
        execute("git push origin v${project.version}")
        println "Generated tag for version ${project.version}"
    }
}
tagRelease.mustRunAfter(commitRelease)

task release(dependsOn: ['commitRelease', 'tagRelease'])
